<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8"/>
		<meta name="og:site_name" content="hawken.is"/>
		<link rel="canonical" href="https://www.hawken.is/writing/2020/float-overhead"/>
		<meta name="twitter:url" content="https://www.hawken.is/writing/2020/float-overhead"/>
		<meta name="og:url" content="https://www.hawken.is/writing/2020/float-overhead"/>
		<title>Python floats | hawken.is</title>
		<meta name="twitter:title" content="Python floats | hawken.is"/>
		<meta name="og:title" content="Python floats | hawken.is"/>
		<meta name="description" content="My website!"/>
		<meta name="twitter:description" content="My website!"/>
		<meta name="og:description" content="My website!"/>
		<meta name="twitter:card" content="summary"/>
		<link rel="stylesheet" href="/styles.css" type="text/css"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<link rel="shortcut icon" href="/images/favicon.png" type="image/png"/>
		<link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to hawken.is"/>
	</head>
	<body class="item-page">
		<header>
			<div class="wrapper">
				<a class="site-name" href="/">hawken.is</a>
				<nav>
					<ul>
						<li>
							<a href="/cooking">Cooking</a>
						</li>
						<li>
							<a href="/learning">Learning</a>
						</li>
						<li>
							<a href="/listening">Listening</a>
						</li>
						<li>
							<a href="/making">Making</a>
						</li>
						<li>
							<a href="/reading">Reading</a>
						</li>
						<li>
							<a href="/researching">Researching</a>
						</li>
						<li>
							<a class="selected" href="/writing">Writing</a>
						</li>
					</ul>
				</nav>
			</div>
		</header>
		<div class="wrapper">
			<article>
				<div class="content"><h1>Python floats</h1><p>tonight in Degreepath… I reduced the amount of memory needed, by removing the list of duration floats that it was using to compute the average loop duration. (no, I don't know why I was doing this.)</p><p>a python float = 24 bytes in bits =&gt; 192 bits iters = 1,200,000,000</p><p>(float * iters) in GB =&gt; 28.8 GB</p><p>that's right, for a 1.2 billion loop audit, we're using 28+ gigabytes of RAM, just to store the audit loop durations.</p><p>da4c35c6 should reduce that overhead to, oh, about 24 bytes.</p><hr><p>I was like, why do I have a memory leak</p><hr><p>and I was chatting with nolan and realized, oh, I'm storing a float per loop iteration, I wonder how big those are</p><hr><blockquote><p><a href="https://github.com/degreepath/auditor/commit/da4c35c665a7b3c881c3978f2954d0381ea48e25">da4c35c6</a> should reduce that overhead to, oh, about 24 bytes.</p></blockquote><hr><p>"In CPython, every object begins with a reference count (of type ssize_t, i.e. a machine word) and a pointer to the type object for that object, which is necessary to be able to do any operations (e.g. invoke a method) on the object. That's two machine words right there off the bat, before you even start to talk about the data contained in the object. After that header comes a variable amount of data; in the case of a float object, it's just a C double value directly, so another eight bytes. For a 32 bit CPython, that's 4 + 4 + 8 = 16 bytes, for a 64 bit CPython, that's 8 + 8 + 8 = 24 bytes. Note that CPython can also be configured for debug builds, which adds two more pointers to that common header shared by all objects, which are used to form a doubly linked list of all objects on the heap, which can be used to track down reference counting bugs."</p><hr><p>In short, instead of storing [dur, dur, dur] and averaging that list, I just … recompute (now - start) / count each time I need it</p><hr><p>which is also fewer operations, because it's only needed for progress messages (default every 1,000 iters) and the final output</p><p>And we’ve already shown that 1.2 billion floats is 28.8GB…</p></div>
				<span>Tagged with: </span>
				<ul class="tag-list">
					<li>
						<a href="/tags/python">python</a>
					</li>
					<li>
						<a href="/tags/profiling">profiling</a>
					</li>
					<li>
						<a href="/tags/transcript">transcript</a>
					</li>
				</ul>
			</article>
		</div>
		<footer>
			<p>Generated using 
				<a href="https://github.com/johnsundell/publish">Publish</a>
			</p>
			<p>
				<a href="/feed.rss">RSS feed</a>
			</p>
		</footer>
	</body>
</html>